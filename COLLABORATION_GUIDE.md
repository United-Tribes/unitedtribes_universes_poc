# Collaboration Guide — Pluribus Universes POC

A practical guide for Justin and colleague working on the same codebase.

---

## The Big Challenge: One File

Almost all the app code lives in `src/App.jsx` (~7,300 lines). This means any time you're both editing the app, you're editing the same file. Git can handle this when changes are in different parts of the file, but if you're editing nearby lines, you'll get merge conflicts.

### How to Avoid Conflicts

**1. Claim screens before you start**

Before starting work, tell each other which screen you're working on. The screens are laid out sequentially in App.jsx:

| Screen | Approximate Lines | Owner |
|--------|------------------|-------|
| HomeScreen | ~2800–3100 | |
| ThinkingScreen | ~3100–3300 | |
| ResponseScreen | ~3300–3550 | |
| ConstellationScreen | ~3550–3900 | |
| EntityDetailScreen | ~3900–4400 | |
| Shared Components (cards, rows) | ~4400–4600 | |
| EpisodeCard | ~4600–4800 | |
| ThemesScreen | ~4800–5200 | |
| SonicLayerScreen | ~5200–5400 | |
| CastCrewScreen | ~5400–5900 | |
| EpisodesScreen | ~5900–6100 | |
| EpisodeDetailScreen | ~6100–6500 | |
| LibraryScreen | ~6500–6700 | |
| App (main + SideNav) | ~6700–7300 | |

If Justin is working on SonicLayerScreen and colleague is working on EpisodesScreen, conflicts are unlikely. If both are editing CastCrewScreen, conflicts are guaranteed.

**2. Pull before you start, push when you stop**

```bash
# Start of session
git pull origin main

# End of session — always push your work
git add -A && git commit -m "description" && git push
```

Don't let work sit uncommitted overnight. Stale branches cause bigger conflicts.

**3. Keep commits small and focused**

One screen change per commit, not "updated everything." Small commits are easier to merge and easier to revert if something breaks.

**4. Build before you push**

```bash
npm run build
```

If it doesn't build, don't push. A broken build blocks the other person.

---

## When Merge Conflicts Happen

They will happen eventually. Here's how to handle them:

```bash
# You're on your branch and want to merge in main
git pull origin main

# Git says CONFLICT in src/App.jsx
# Open App.jsx and look for conflict markers:
#   <<<<<<< HEAD
#   (your changes)
#   =======
#   (their changes)
#   >>>>>>> main
```

**Rules for resolving:**
- Read both sides carefully — usually you want to keep both changes
- If unsure, talk to each other before resolving
- After resolving, **always copy App.jsx to PluribusComps.jsx**:
  ```bash
  cp src/App.jsx src/PluribusComps.jsx
  ```
- Build and test before committing the merge

---

## The Mirror File Rule

`PluribusComps.jsx` must always be identical to `App.jsx`. Every time you edit App.jsx:

```bash
cp src/App.jsx src/PluribusComps.jsx
```

This is used for Claude chat artifacts. If they get out of sync, the artifact version breaks. Claude Code knows about this rule and will do it automatically, but double-check if you're making manual edits.

---

## Data Files

The JSON data in `src/data/` is generated by the harvester pipeline and then manually enriched. Treat these files carefully:

- **`pluribus-response.json`** — If you need to add per-episode data, actor mappings, or song metadata, edit this file. But coordinate — if both people edit it at the same time, you'll get conflicts.
- **`pluribus-universe.json`** — This is generated by the harvester's assemble stage. Don't hand-edit it; re-run the assembler instead.
- **`public/images/manual/`** — Safe to add images here independently. No conflict risk since each image is a separate file.

If you need to re-run the harvester, see the "Harvester Data Pipeline" section in `CLAUDE.md`.

---

## Deploying

Only deploy from `main` to keep production stable:

```bash
git checkout main
bash deploy.sh
```

This builds and uploads to S3. The live URL is:
http://unitedtribes-visualizations-1758769416.s3-website-us-east-1.amazonaws.com/universes-poc/index.html

**Coordinate deploys** — don't deploy while the other person is in the middle of merging into main.

---

## Communication Checklist

Before starting a session:
- [ ] "I'm going to work on [screen/feature]"
- [ ] `git pull origin main`

Before pushing:
- [ ] `npm run build` passes
- [ ] `cp src/App.jsx src/PluribusComps.jsx`
- [ ] Commit message describes what changed

Before deploying:
- [ ] "I'm about to deploy — are you clear?"
- [ ] On the `main` branch with latest changes

---

## Using Claude Code

Both of you can use Claude Code independently. The `CLAUDE.md` file gives Claude full context on the architecture. A few tips:

- **Always tell Claude which screen you're working on** — this helps it make targeted edits instead of touching unrelated code
- **Ask Claude to build after changes** — catch errors before pushing
- **Have Claude mirror the file** — say "copy App.jsx to PluribusComps.jsx" or it may forget
- **Review what Claude changed** — use `git diff` before committing to make sure changes are scoped to what you asked for

---

## Quick Reference

| Task | Command |
|------|---------|
| Start dev server | `npm run dev` |
| Build | `npm run build` |
| Deploy to production | `bash deploy.sh` (from main branch) |
| Mirror after edit | `cp src/App.jsx src/PluribusComps.jsx` |
| Pull latest | `git pull origin main` |
| See what changed | `git diff` |
| See which files changed | `git status` |
